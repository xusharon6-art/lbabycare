<!doctype html>
<html lang="zh-CN" data-theme="light">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>å©´å¹¼å„¿å‘å±•è¿½è¸ª v2.6.1ï¼ˆé›¶ä¾èµ–SVGæŠ˜çº¿å›¾ï¼‰</title>
<style>
:root{
  --bg:#ffffff; --fg:#1f2937; --muted:#6b7280; --card:#f8fafc; --accent:#2563eb;
  --chip:#e5e7eb; --chip-active:#dbeafe; --line:#e5e7eb; --link:#2563eb;
}
:root[data-theme="dark"]{
  --bg:#0b1220; --fg:#e5e7eb; --muted:#9ca3af; --card:#141b2e; --accent:#60a5fa;
  --chip:#1f2937; --chip-active:#0b3569; --line:#1f2937; --link:#93c5fd;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial,"Noto Sans SC","PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif;line-height:1.5}
.container{max-width:1200px;margin:0 auto;padding:20px}
.toolbar{display:flex;gap:8px;align-items:center;justify-content:space-between;position:sticky;top:0;background:var(--bg);padding:12px 0;z-index:10}
.toolbar-left,.toolbar-right{display:flex;gap:8px;align-items:center}
.btn{appearance:none;border:1px solid var(--line);background:var(--card);color:var(--fg);padding:8px 12px;border-radius:999px;cursor:pointer}
.btn:hover{border-color:var(--accent)}
.select,.input{border:1px solid var(--line);padding:8px 12px;border-radius:10px;background:var(--bg);color:var(--fg)}
.input.num{width:68px;text-align:center}
.tabs{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 16px}
.tab{padding:10px 14px;border-radius:999px;border:1px solid var(--line);cursor:pointer;background:var(--chip);color:var(--fg)}
.tab.active{background:var(--chip-active);border-color:var(--accent)}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}
@media (max-width:900px){.grid-2,.grid-3{grid-template-columns:1fr}}
h1{font-size:22px;margin:6px 0 2px}
h2{font-size:18px;margin:12px 0 8px}
hr{border:none;border-top:1px solid var(--line);margin:12px 0}
.table{width:100%;border-collapse:collapse;font-size:14px}
.table th,.table td{border-top:1px solid var(--line);padding:8px;vertical-align:top}
.table th{font-weight:600;text-align:left;color:var(--muted)}
.chips{display:flex;flex-wrap:wrap;gap:8px}
.chip{border:1px solid var(--line);background:var(--chip);padding:8px 12px;border-radius:999px;cursor:pointer}
.chip.active{background:var(--chip-active);border-color:var(--accent)}
.muted{color:var(--muted)}
.footer{margin:24px 0 40px;color:var(--muted);text-align:center}
a{color:var(--link);text-decoration:none}
a:hover{text-decoration:underline}
.small{font-size:12px}
.chart-wrap{height:320px}
.small-chart{height:220px}
svg{width:100%;height:100%}
/* æ‰“å°ä»…ä¿ç•™å†…å®¹åŒº */
@media print{
  .toolbar,.tabs{display:none !important}
  body{background:#fff;color:#000}
  .card{border:none}
}
</style>
</head>
<body>
  <div class="container">
    <div class="toolbar">
      <div class="toolbar-left">
        <button class="btn" id="themeBtn">ğŸŒ— ä¸»é¢˜</button>
        <button class="btn" id="printBtn">ğŸ–¨ æ‰“å°</button>
        <button class="btn" id="resetBtn">ğŸ—‘ é‡ç½®</button>
      </div>
      <div class="toolbar-right small">
        <span>å©´å¹¼å„¿å‘å±•è¿½è¸ª v2.6.1 Â· é›¶ä¾èµ–SVG</span>
      </div>
    </div>

    <div class="tabs" id="tabs"></div>

    <!-- æŒ‡æ ‡æ›²çº¿ï¼ˆæŒ‰æœˆï¼‰ -->
    <section class="card" id="tab-0" hidden>
      <h1>æŒ‡æ ‡æ›²çº¿ï¼ˆæŒ‰æœˆï¼‰</h1>
      <div class="grid-3">
        <div>
          <h2>é€‰æ‹©ç»´åº¦</h2>
          <div id="domainChips" class="chips"></div>
        </div>
        <div>
          <h2>é€‰æ‹©æœˆé¾„</h2>
          <select class="select" id="ageSelect"></select>
        </div>
        <div>
          <h2>æ ‡å‡†çº¿</h2>
          <div style="display:flex;gap:8px;align-items:center">
            <label class="muted">åŸºå‡†åˆ†ï¼ˆ0â€“10ï¼‰</label>
            <input id="stdLine" class="input num" type="number" min="0" max="10" step="1" value="8" />
          </div>
        </div>
      </div>

      <div class="grid-2" style="margin-top:12px">
        <div class="card">
          <h2>æŒ‡æ ‡æ‰“åˆ†</h2>
          <table class="table">
            <thead><tr><th style="width:60%">æŒ‡æ ‡</th><th>åˆ†å€¼ï¼ˆ1â€“10ï¼‰</th></tr></thead>
            <tbody id="indicatorRows"></tbody>
          </table>
          <div style="display:flex;gap:8px;margin-top:10px">
            <button class="btn" id="fillDemo">ç¤ºä¾‹å¡«å……</button>
            <button class="btn" id="clearThis">æ¸…ç©ºæœ¬æœˆæŒ‡æ ‡</button>
            <span class="muted small" id="saveHint"></span>
          </div>
        </div>
        <div class="card">
          <h2>æœ¬æœˆæŒ‡æ ‡æ›²çº¿</h2>
          <div class="chart-wrap" id="monthlyChart"></div>
          <p class="small muted">çºµè½´å›ºå®š 0â€“10ï¼›ç°è‰²è™šçº¿ä¸ºæ ‡å‡†çº¿ï¼›ç©ºå€¼æ–­å¼€ã€‚</p>
        </div>
      </div>
    </section>

    <!-- èƒ½åŠ›æ›²çº¿ï¼ˆ6â€“36æœˆï¼‰ -->
    <section class="card" id="tab-1" hidden>
      <h1>èƒ½åŠ›æ›²çº¿ï¼ˆ6â€“36 æœˆï¼‰</h1>
      <p class="muted small">è§„åˆ™ï¼šåŒä¸€ç»´åº¦æ¯ä¸ªå·²å½•å…¥æœˆé¾„çš„æŒ‡æ ‡<strong>å‡å€¼Ã—10</strong>ï¼ˆå››èˆäº”å…¥ï¼‰ï¼Œæœªå½•å…¥åˆ™æ–­ç‚¹ã€‚å¸¦çŠ¶ä¸ºå‚è€ƒçº¿ Â±10ã€‚</p>
      <div id="smallCharts" class="grid-2"></div>
    </section>

    <!-- å®¶åº­ç¯å¢ƒè¯„ä¼° -->
    <section class="card" id="tab-2" hidden>
      <h1>å®¶åº­ç¯å¢ƒè¯„ä¼°</h1>
      <p class="muted small">æ¯é¡¹ 1â€“5 åˆ†ï¼›ç‚¹å‡»â€œè®¡ç®—è¯„åˆ†â€ç”Ÿæˆå¹³å‡åˆ†ã€ç­‰çº§ä¸å»ºè®®ã€‚è¯„åˆ†ç±»åˆ«ï¼šéœ€åŠ å¼º/åŸºæœ¬è¾¾æ ‡/è‰¯å¥½/ä¼˜ç§€ã€‚</p>
      <table class="table">
        <thead><tr><th style="width:18%">æ¡ç›®</th><th>æ ‡å‡†å€¼æè¿°</th><th style="width:160px">è¯„åˆ†ï¼ˆ1â€“5ï¼‰</th></tr></thead>
        <tbody id="homeRows"></tbody>
      </table>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="btn" id="homeCalc">è®¡ç®—è¯„åˆ†</button>
        <button class="btn" id="homeClear">æ¸…ç©º</button>
        <button class="btn" id="homeSave">ä¿å­˜</button>
      </div>
      <div id="homeResult" class="card" style="margin-top:12px"></div>
    </section>

    <!-- å¯¼å…¥å¯¼å‡º -->
    <section class="card" id="tab-3" hidden>
      <h1>å¯¼å…¥å¯¼å‡º / æŒä¹…åŒ–</h1>
      <div class="grid-2">
        <div>
          <h2>å¯¼å‡º JSON</h2>
          <button class="btn" id="exportBtn">ä¸‹è½½ devtracker-v2_6_1-data.json</button>
          <pre id="jsonPreview" class="card small" style="white-space:pre-wrap;margin-top:8px;max-height:300px;overflow:auto"></pre>
        </div>
        <div>
          <h2>å¯¼å…¥ JSON</h2>
          <input type="file" id="importFile" accept=".json" class="input" />
          <p class="muted small">é€‰æ‹©ç”±æœ¬å·¥å…·å¯¼å‡ºçš„åŒç‰ˆæœ¬ JSON è¦†ç›–æœ¬åœ°æ•°æ®ã€‚</p>
        </div>
      </div>
    </section>

    <div class="footer small">Â© 2025 DevTracker v2.6.1 Â· å•æ–‡ä»¶ Â· é›¶ä¾èµ– Â· SVG æŠ˜çº¿å›¾</div>
  </div>

<script>
// ====== æ•°æ®ä¸çŠ¶æ€ ======
const DOMAINS=['è®¤çŸ¥èƒ½åŠ›','æ•°å­¦é€»è¾‘','è¯­è¨€èƒ½åŠ›','å¤§åŠ¨ä½œèƒ½åŠ›','ç²¾ç»†åŠ¨ä½œèƒ½åŠ›','è‰ºæœ¯è¡¨ç°','è‡ªç†èƒ½åŠ›','äº¤å¾€èƒ½åŠ›'];
const AGE_LIST=[6,12,18,24,30,36];
const LS_KEY='devtracker_v2_6_1';
const REF_BAND=10;

// æŒ‡æ ‡æ–‡æœ¬ï¼ˆç¤ºä¾‹é›†ï¼‰
const INDICATOR_TEXT={
  'è®¤çŸ¥èƒ½åŠ›':{6:['ç›®å…‰è¿½éšç§»åŠ¨ç‰©ä½“','æ³¨è§†æ—¶é•¿â‰¥3ç§’','å¯»æ‰¾éƒ¨åˆ†é®æŒ¡çš„ç©å…·','åˆ†è¾¨ç†Ÿäºº/é™Œç”Ÿäººè¡¨æƒ…','å¯¹æ–°å¥‡åˆºæ¿€è½¬å¤´å®šä½'],
 12:['ç‰©ä½“æ°¸ä¹…æ€§åˆæ˜¾','ä¸¤æ­¥å› æœæ¢ç´¢ï¼ˆæ‹/æ¨ï¼‰','æ¨¡ä»¿ç®€å•åŠ¨ä½œ','æ³¨æ„åŠ›è½¬ç§»','æ¢ç´¢å¼æ•²æ‰“/æ‘‡æ™ƒ'],
 18:['ä¸‰æ­¥å› æœæ¢ç´¢','åŠŸèƒ½æ€§ä½¿ç”¨ç‰©å“','ç®€æ˜“åˆ†ç±»é…å¯¹','æŒ‡è®¤ç†Ÿæ‚‰ç‰©ä½“','å°è¯•è§£é”/æ‰“å¼€'],
 24:['ä¸¤æ­¥è§„åˆ™å®Œæˆ','æŒ‰é¢œè‰²æˆ–å½¢çŠ¶åˆ†ç±»','ç®€å•æ‹¼æ­','è®°ä½2æ­¥æŒ‡ä»¤','ç‹¬ç«‹æ¢ç´¢é¡ºåº'],
 30:['ç®€å•é—®é¢˜æ±‚è§£','3ç±»ä»¥ä¸Šåˆ†ç±»','æ‹¼å›¾3â€“4å—','å› æœæ¨æ–­å¢å¼º','æƒ…å¢ƒä¸­å›å¿†'],
 36:['å¤šæ­¥éª¤è§„åˆ™','æ•°é‡å®ˆæ’åˆæ˜¾','6å—æ‹¼å›¾','ç®€å•è§’è‰²æ‰®æ¼”è§„åˆ’','å»¶è¿Ÿæ»¡è¶³']},
  'æ•°å­¦é€»è¾‘':{6:['æ³¨è§†æ•°é‡å·®å¼‚','è¿½è§†æ•°é‡å˜åŒ–','å¯¹èŠ‚å¥æœ‰ååº”','å¯¹é‡å¤äº§ç”ŸæœŸå¾…','çŸ­æ—¶è®°å¿†2ç§’'],
 12:['ç†è§£â€œæ›´å¤š/æ›´å°‘â€','æ‹æ‰‹æŒ‰èŠ‚å¥','é…å¯¹ç›¸åŒç‰©ä½“','æŒ‰å¤§å°æ’ä¸¤çº§','å¯¹â€œä¸€ä¸ª/ä¸¤ä¸ªâ€æ•æ„Ÿ'],
 18:['å£å¤´ç‚¹æ•°1-3','æŒ‰å¤§å°æ’åº3çº§','ç®€å•å›¾å½¢é…å¯¹','å®Œæˆ2æ­¥æ‹¼æ’','æ¯”è¾ƒå¤šå°‘'],
 24:['ç‚¹æ•°åˆ°5','æŒ‰ç±»èšåˆ3ç»„','ç®€å•æ¨¡å¼ABAB','åŒ¹é…æ•°å­—1-3','æ¯”è¾ƒé•¿çŸ­é«˜ä½'],
 30:['ç‚¹æ•°åˆ°7','å»¶ç»­æ¨¡å¼AAB','3ç»´åˆ†ç±»','ç†è§£0æ¦‚å¿µåˆæ˜¾','ç®€å•åŠ ä¸€'],
 36:['ç‚¹æ•°åˆ°10','å¤æ‚æ¨¡å¼ABC','æ¯”è¾ƒå·®å€¼','å›¾å½¢ç»„æˆ','ç®€å•å‡ä¸€']},
  'è¯­è¨€èƒ½åŠ›':{6:['å¯¹åå­—æœ‰ååº”','å’¿å‘€å‘å£°','è½¬å¤´å¯»æ‰¾å£°éŸ³','é«˜å…´æ—¶ç¬‘å£°','æ¨¡ä»¿éŸ³èŠ‚'],
 12:['ä¼šè¯´1-3ä¸ªè¯','ç†è§£â€œä¸è¦â€','æŒ‡ç‰©å‘½å','æ‰‹åŠ¿è¡¨è¾¾','å¬æ‡‚ç†Ÿæ‚‰æŒ‡ä»¤'],
 18:['ä¼šè¯´10+è¯','ä¸¤è¯çŸ­è¯­','å‘½åå¸¸è§ç‰©','ç†è§£â€œç»™æˆ‘â€','æ¨¡ä»¿æ–°è¯'],
 24:['ä¸‰è¯å¥','æé—®â€œè¿™æ˜¯ä»€ä¹ˆâ€','ç†è§£æ–¹ä½è¯','è®²è¿°ç®€å•éœ€è¦','è·Ÿè¯»çŸ­å¥'],
 30:['å››è¯å¥','è®²è¿°ç»å†ç‰‡æ®µ','ç†è§£å¤åˆæŒ‡ä»¤','åŸºæœ¬æ—¶æ€æ„è¯†','å¤è¿°æ•…äº‹è¦ç‚¹'],
 36:['è¿è´¯è¡¨è¾¾','ä½¿ç”¨å› æœè¿è¯','ç†è§£ç®€å•ç–‘é—®å¥','æƒ…ç»ªè¨€è¯­è¡¨è¾¾','è®²è¿°å®Œæ•´ç»å†']},
  'å¤§åŠ¨ä½œèƒ½åŠ›':{6:['æŠ¬å¤´ç¨³å®š','ç¿»èº«','ä¿¯å§æ”¯æ’‘','åå§¿è¾…åŠ©','æŠ“æ¡æ”¯æ’‘'],
 12:['ç‹¬ç«™ç‰‡åˆ»','æ‰¶ç‰©èµ°','è¹²èµ·','æ”€çˆ¬ä½å°é˜¶','æŠ›æ·å¤§çƒ'],
 18:['ç‹¬èµ°ç¨³','åé€€æ•°æ­¥','åŠ©è·‘è¸¢çƒ','è·¨å°éšœç¢','æ¬è¿å°ç‰©'],
 24:['åŒè„šèµ·è·³','ä¸Šä¸‹å°é˜¶æ‰¶æ ','æ¥æ»šæ¥çš„çƒ','å¹³è¡¡æœ¨è¿ˆæ­¥','çŸ­è·ç¦»è·‘'],
 30:['å•è„šç«™1-2ç§’','åŒè„šè·³å‰è¿›','ä¸Šæ¥¼äº¤æ›¿æ­¥','è¸¢çƒæ›´å‡†','è½¬èº«è·‘åœ'],
 36:['å•è„šè·³','ä¸‹æ¥¼äº¤æ›¿æ­¥','æŠ›æ¥è½»çƒ','30ç§’å¹³è¡¡','åŸåœ°è¿ç»­è·³']},
  'ç²¾ç»†åŠ¨ä½œèƒ½åŠ›':{6:['æŠ“æ¡æ‘‡é“ƒ','åŒæ‰‹ä¼ ç‰©','æ•²æ‰“æ¡Œé¢','æ’®æ¡å°è¯•','æ³¨è§†æ‰‹éƒ¨'],
 12:['æ‹‡é£ŸæŒ‡æ','ç¿»ä¹¦é¡µ','æŠŠç§¯æœ¨æ”¾ç›’','æ¶‚é¸¦ç—•è¿¹','æ’æ£’å¤§å­”'],
 18:['å †2-3å—','ç”»ç›´çº¿ç—•è¿¹','ç©¿å¤§å­”ç»³','ç¿»ä¹¦å¤šé¡µ','æ‹¨åŠ¨å¼€å…³'],
 24:['å †5å—','ç”»åœ†åœˆç—•è¿¹','è½¬åŠ¨æ—‹é’®','æ’•çº¸æ¡','æ‹¼æ’å½¢çŠ¶å—'],
 30:['å‰ªçº¸ç›´çº¿','ç”»åå­—ç—•è¿¹','æ‰£å¤§æ‰£å­','æ‹§ç“¶ç›–','å¤¹å–å°ç‰©'],
 36:['æç”»ç®€å•å½¢','ç©¿ç å­','å‰ªçº¸æ›²çº¿','ç”»äººå¤´è¶³','ä½¿ç”¨å‹ºå‰å‡†']},
  'è‰ºæœ¯è¡¨ç°':{6:['å¯¹éŸ³ä¹å¾®ç¬‘','éšèŠ‚å¥æ‘†åŠ¨','æ³¨è§†è‰²å½©','æ¨¡ä»¿éŸ³é«˜','æ‹æ‰‹åº”å’Œ'],
 12:['éšéŸ³ä¹å¾‹åŠ¨','é€‰æ‹©å–œæ¬¢ä¹å™¨','å æ”¾å½©å—','æ¨¡ä»¿è¡¨æƒ…','è‡ªç”±æ¶‚é¸¦'],
 18:['èŠ‚å¥å¾‹åŠ¨å‡†ç¡®','ç”¨è‰²å—é…è‰²','å”±ç®€çŸ­æ—‹å¾‹','è§’è‰²æ¨¡ä»¿','ç”¨çº¿æ¡è¡¨è¾¾'],
 24:['è·Ÿå”±å„¿æ­Œ','é¢œè‰²æ­é…2-3è‰²','æ¨¡ä»¿ç”»å½¢','èŠ‚å¥é“å…·ä½¿ç”¨','è§’è‰²æ‰®æ¼”'],
 30:['è‡ªä¸»æ­Œå”±','ç»˜ç”»åŸºæœ¬å½¢çŠ¶','èŠ‚å¥å˜æ¢','æ­å»ºä¸»é¢˜ä½œå“','è®²è¿°ä½œå“'],
 36:['åˆ›ç¼–æ—‹å¾‹','ä¸»é¢˜ç»˜ç”»å®Œæ•´','èŠ‚å¥æŒ‡æŒ¥','èˆè¹ˆç»„åˆ','æˆå‰§æ€§è¡¨è¾¾']},
  'è‡ªç†èƒ½åŠ›':{6:['é…åˆå–‚å…»','æ¡å¥¶ç“¶','å¯¹ç©¿è¡£æœ‰ååº”','æ‹èƒŒå…¥ç¡','è§„å¾‹æ’ä¾¿åˆæ˜¾'],
 12:['ç”¨æ¯å–æ°´','å¸®å¿™ä¼¸æ‰‹è„š','å°è¯•ç”¨å‹º','æŒ‡ç¤ºçº¸å°¿è£¤æ¹¿äº†','å…¥ç¡è§„å¾‹'],
 18:['è„±ç®€å•è¡£ç‰©','ç‹¬ç«‹ç”¨å‹ºéƒ¨åˆ†æˆåŠŸ','æ´—æ‰‹é…åˆ','ç¤ºæ„å¦‚å•','ç©¿é‹å°è¯•'],
 24:['åŸºæœ¬ç”¨å‹º','ç©¿è„±éƒ¨åˆ†è¡£ç‰©','ååŠ©åˆ·ç‰™','å¦‚å•è®­ç»ƒä¸­','æ”¶æ‹¾ç©å…·'],
 30:['ç‹¬ç«‹ç”¨å‹º/å‰','ç©¿è„±ç®€å•è¡£ç‰©','ç®€å•åˆ·ç‰™æ¼±å£','æ´—æ‰‹æµç¨‹','æ•´ç†ä¸ªäººç‰©å“'],
 36:['ç‹¬ç«‹è¿›é¤','ç©¿è„±è¡£è£¤é‹è¢œ','ç‹¬ç«‹å¦‚å•','ç®€å•å®¶åŠ¡','å®‰å…¨è‡ªæŠ¤æ„è¯†']},
  'äº¤å¾€èƒ½åŠ›':{6:['æ³¨è§†äººè„¸','å¯¹ç¬‘å®¹å›åº”','å¯¹æŠ±èµ·æœ‰ååº”','è·Ÿéšæˆäººç›®å…‰','åŸºæœ¬åˆ†ç¦»ç„¦è™‘'],
 12:['é™Œç”Ÿæƒ…å¢ƒå›é¿','ä¸æˆäººäº’åŠ¨æ¸¸æˆ','ä¸åŒä¼´å¹³è¡Œæ¸¸æˆ','åˆ†äº«å…´è¶£','ç¤¾ä¼šæ€§å¾®ç¬‘'],
 18:['ä¸åŒä¼´æœ‰äº’åŠ¨','è½®æµç­‰å¾…åˆæ˜¾','è¡¨è¾¾æƒ…ç»ªéœ€æ±‚','æ¨¡ä»¿åŒä¼´','å®‰æ…°ä»–äººå°è¯•'],
 24:['åˆä½œæ¸¸æˆ','éµå®ˆç®€å•è§„åˆ™','åˆ†äº«è½®æµ','è¡¨è¾¾åŒç†','ä¸åŒä¼´ååŒ'],
 30:['å°ç»„åˆä½œ','å†²çªåå•†','éµå®ˆå®¶åº­è§„åˆ™','è§’è‰²åä½œ','è¡¨è¾¾ç¤¼è²Œ'],
 36:['åŒä¼´åä½œä»»åŠ¡','è§„åˆ™æ¸¸æˆ','è§£å†³å†²çª','é¢†å¯¼/è·Ÿéšè§’è‰²','ç†è§£ç¤¾ä¼šè§„èŒƒ']}
};

const REF_DEFAULT={
  'è®¤çŸ¥èƒ½åŠ›':[40,55,65,75,82,88],
  'æ•°å­¦é€»è¾‘':[35,50,60,70,78,85],
  'è¯­è¨€èƒ½åŠ›':[30,48,60,72,80,88],
  'å¤§åŠ¨ä½œèƒ½åŠ›':[45,60,70,80,88,92],
  'ç²¾ç»†åŠ¨ä½œèƒ½åŠ›':[32,48,60,72,80,88],
  'è‰ºæœ¯è¡¨ç°':[30,45,58,70,78,86],
  'è‡ªç†èƒ½åŠ›':[28,44,58,70,82,90],
  'äº¤å¾€èƒ½åŠ›':[34,50,62,74,82,90]
};

let indicatorScores = loadLS()?.indicatorScores || initScores();
let homeScores = loadLS()?.homeScores || Array(12).fill(3); // é»˜è®¤å±…ä¸­3åˆ†
let curDomain = DOMAINS[0];
let curAge = AGE_LIST[0];

// ====== DOM åˆå§‹åŒ– ======
const tabDefs=['æŒ‡æ ‡æ›²çº¿ï¼ˆæŒ‰æœˆï¼‰','èƒ½åŠ›æ›²çº¿ï¼ˆ6â€“36æœˆï¼‰','å®¶åº­ç¯å¢ƒ','å¯¼å…¥å¯¼å‡º'];
const tabsEl=document.getElementById('tabs');
tabDefs.forEach((t,i)=>{
  const b=document.createElement('button');
  b.className='tab'+(i===0?' active':'');
  b.textContent=t; b.onclick=()=>switchTab(i);
  tabsEl.appendChild(b);
});
document.getElementById('tab-0').hidden=false;

const chipsEl=document.getElementById('domainChips');
DOMAINS.forEach((d,i)=>{
  const c=document.createElement('button');
  c.className='chip'+(i===0?' active':'');
  c.textContent=d; c.onclick=()=>setDomain(d);
  chipsEl.appendChild(c);
});
const ageSelect=document.getElementById('ageSelect');
AGE_LIST.forEach(a=>{ const o=document.createElement('option'); o.value=a; o.textContent=a+' æœˆ'; ageSelect.appendChild(o); });
ageSelect.onchange=()=>setAge(parseInt(ageSelect.value));

document.getElementById('fillDemo').onclick=demoFill;
document.getElementById('clearThis').onclick=clearThisMonth;
document.getElementById('stdLine').onchange=renderMonthlyChart;

// Toolbar
document.getElementById('themeBtn').onclick=toggleTheme;
document.getElementById('printBtn').onclick=()=>window.print();
document.getElementById('resetBtn').onclick=()=>{
  if(confirm('ç¡®è®¤æ¸…ç©ºæ‰€æœ‰è¯„åˆ†ä¸æœ¬åœ°å­˜å‚¨ï¼Ÿ')){
    localStorage.removeItem(LS_KEY);
    indicatorScores = initScores();
    homeScores = Array(12).fill(3);
    updateIndicatorsTable(); renderMonthlyChart(); renderSmallCharts(true);
    buildHomeTable(); document.getElementById('homeResult').innerHTML='';
    toast('å·²é‡ç½®');
  }
};

// å®¶åº­ç¯å¢ƒï¼ˆ12é¡¹+å»ºè®®ï¼‰
const HOME_ITEMS=[
  ['ä½œæ¯','å›ºå®šä½œæ¯ã€ç¨³å®šæ˜¼å¤œèŠ‚å¾‹','1=æ— è§„å¾‹; 3=åŸºæœ¬è§„å¾‹; 5=ç¨³å®šè§„å¾‹'],
  ['å®‰å…¨','ç”¨ç”µ/å®¶å…·/è¾¹è§’/é—¨çª—é˜²æŠ¤å®Œå–„','1=éšæ‚£å¤š; 3=éƒ¨åˆ†é˜²æŠ¤; 5=é˜²æŠ¤å®Œå–„'],
  ['å›åº”æ€§','æˆäººå¯¹ä¿¡å·åŠæ—¶å›åº”','1=å¿½è§†; 3=ä¸€èˆ¬; 5=æ•æ„Ÿå›åº”'],
  ['è¯­è¨€ç¯å¢ƒ','æœ‰äº’åŠ¨æ€§è¯­è¨€ä¸æŒ‡ä»¤','1=æå°‘äº’åŠ¨; 3=ä¸€èˆ¬; 5=ä¸°å¯Œäº’åŠ¨'],
  ['äº²å­é˜…è¯»','æ¯å‘¨æœ‰å›ºå®šäº²å­é˜…è¯»','1=æ— ; 3=æ¯å‘¨1-2æ¬¡; 5=æ¯æ—¥15min+'],
  ['æ¸¸æˆææ–™','é€‚é¾„å®‰å…¨ã€å¼€æ”¾æ€§ææ–™','1=åŒ®ä¹; 3=åŸºæœ¬å¤Ÿ; 5=ä¸°å¯Œå¤šæ ·'],
  ['å±å¹•æš´éœ²','æ—¶é•¿ä¸å†…å®¹å¯æ§','1=è¶…2h/æ—¥; 3=<1h/æ—¥; 5=å‡ ä¹ä¸ç”¨'],
  ['ç¡çœ ç¯å¢ƒ','å®‰é™ã€å…‰ç…§ä¸æ¸©æ¹¿é€‚å®œ','1=å·®; 3=ä¸€èˆ¬; 5=è‰¯å¥½'],
  ['è¥å…»å–‚å…»','å‡è¡¡é¥®é£Ÿä¸è§„å¾‹åŠ é¤','1=åé£Ÿä¸¥é‡; 3=åŸºæœ¬å‡è¡¡; 5=å‡è¡¡è§„å¾‹'],
  ['å«ç”Ÿæ¶ˆæ¯’','è‰¯å¥½å«ç”Ÿä¹ æƒ¯','1=å·®; 3=ä¸€èˆ¬; 5=è‰¯å¥½'],
  ['ç¤¾ä¼šäº’åŠ¨','æœ‰é«˜è´¨é‡åŒä¼´/æˆäººäº’åŠ¨','1=å¾ˆå°‘; 3=å¶å°”; 5=ç»å¸¸'],
  ['å®¶é•¿å‹åŠ›','å®¶é•¿å‹åŠ›å¯è°ƒèŠ‚','1=é«˜å‹; 3=å¯æ§; 5=è‰¯å¥½è°ƒèŠ‚']
];
const HOME_SUGG={
  'éœ€åŠ å¼º':'å»ºè®®å»ºç«‹ä½œæ¯/å®‰å…¨æ¸…å•ï¼Œå¢åŠ äº’åŠ¨ä¸è§„å¾‹æ€§ï¼›ä¼˜å…ˆä¿®è¡¥æ˜æ˜¾çŸ­æ¿ã€‚',
  'åŸºæœ¬è¾¾æ ‡':'ä¿æŒå…³é”®ç¯èŠ‚ï¼Œé’ˆå¯¹å¼±é¡¹è®¾ç«‹æ¯å‘¨å¾®ç›®æ ‡é€æ­¥æ”¹å–„ã€‚',
  'è‰¯å¥½':'ç»§ç»­å·©å›ºç°æœ‰åšæ³•ï¼Œå¯å¼•å…¥æ›´é«˜è´¨é‡äº’åŠ¨ä¸æ–¹æ¡ˆã€‚',
  'ä¼˜ç§€':'ç»´æŒå¹¶ä½œä¸ºå®¶åº­èŒƒä¾‹ï¼Œæ‹“å±•åˆ°æ›´å¤šç”Ÿæ´»/å­¦ä¹ æƒ…å¢ƒã€‚'
};
function buildHomeTable(){
  const body=document.getElementById('homeRows');
  body.innerHTML='';
  HOME_ITEMS.forEach((it,idx)=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td><strong>${it[0]}</strong></td>
      <td class="small">${it[1]}<br><span class="muted">${it[2]}</span></td>
      <td><select class="select" data-home="${idx}">${[1,2,3,4,5].map(v=>`<option value="${v}" ${homeScores[idx]===v?'selected':''}>${v}</option>`).join('')}</select></td>`;
    body.appendChild(tr);
  });
}
document.getElementById('homeClear').onclick=()=>{
  homeScores = Array(12).fill(3);
  buildHomeTable();
  document.getElementById('homeResult').innerHTML='';
  saveLS();
};
document.getElementById('homeSave').onclick=()=>{
  document.querySelectorAll('[data-home]').forEach(s=>{ homeScores[parseInt(s.dataset.home)] = parseInt(s.value); });
  saveLS(true);
};
document.getElementById('homeCalc').onclick=()=>{
  document.querySelectorAll('[data-home]').forEach(s=>{ homeScores[parseInt(s.dataset.home)] = parseInt(s.value); });
  const vals=[...homeScores];
  const avg=(vals.reduce((a,b)=>a+b,0)/vals.length).toFixed(2);
  const levels=vals.map(v=> v<=2?'éœ€åŠ å¼º':(v===3?'åŸºæœ¬è¾¾æ ‡':(v===4?'è‰¯å¥½':'ä¼˜ç§€')) );
  const list=HOME_ITEMS.map((it,i)=>`<li><strong>${it[0]}</strong>ï¼š${levels[i]} Â· <span class="muted">${HOME_SUGG[levels[i]]}</span></li>`).join('');
  document.getElementById('homeResult').innerHTML = `<h2>ç»“æœ</h2>
    <p>å¹³å‡åˆ†ï¼š<strong>${avg}</strong></p><ul>${list}</ul>`;
  saveLS();
};

// å¯¼å…¥å¯¼å‡º
document.getElementById('exportBtn').onclick=()=>{
  const data = { version:'v2.6.1', indicatorScores, homeScores };
  const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'devtracker-v2_6_1-data.json';
  a.click();
};
document.getElementById('importFile').addEventListener('change', (e)=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    try{
      const obj = JSON.parse(reader.result);
      if(obj && (obj.indicatorScores || obj.homeScores)){
        if(obj.indicatorScores) indicatorScores = obj.indicatorScores;
        if(obj.homeScores) homeScores = obj.homeScores;
        saveLS();
        updateIndicatorsTable();
        renderMonthlyChart();
        renderSmallCharts(true);
        buildHomeTable();
        document.getElementById('homeResult').innerHTML='';
        toast('å¯¼å…¥æˆåŠŸ');
      }else{
        alert('JSON ç»“æ„ä¸æ­£ç¡®');
      }
    }catch(err){ alert('è§£æå¤±è´¥ï¼š'+err.message); }
  };
  reader.readAsText(file,'utf-8');
});

// åˆå§‹åŒ–é»˜è®¤è§†å›¾
setDomain(curDomain);
setAge(curAge);
updateIndicatorsTable();
buildHomeTable();
renderMonthlyChart();
renderSmallCharts(true);

// ====== å·¥å…·å‡½æ•°ä¸æ¸²æŸ“ ======
function initScores(){
  const o={};
  DOMAINS.forEach(d=>{
    o[d]={};
    AGE_LIST.forEach(a=>{
      const n = (INDICATOR_TEXT[d] && INDICATOR_TEXT[d][a]) ? INDICATOR_TEXT[d][a].length : 0;
      o[d][a] = Array(n).fill(null);
    });
  });
  return o;
}
function setDomain(d){
  curDomain=d;
  [...document.querySelectorAll('.chip')].forEach(c=>c.classList.toggle('active', c.textContent===d));
  updateIndicatorsTable();
  renderMonthlyChart();
}
function setAge(a){
  curAge=a;
  document.getElementById('ageSelect').value = String(a);
  updateIndicatorsTable();
  renderMonthlyChart();
}
function updateIndicatorsTable(){
  const tbody=document.getElementById('indicatorRows');
  tbody.innerHTML='';
  const texts = INDICATOR_TEXT[curDomain]?.[curAge] || [];
  const scores = indicatorScores[curDomain]?.[curAge] || [];
  texts.forEach((t,idx)=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${t}</td>
      <td><input class="input num" type="number" min="1" max="10" step="1" value="${scores[idx]??''}" data-idx="${idx}" /></td>`;
    tbody.appendChild(tr);
  });
  tbody.querySelectorAll('input').forEach(inp=>{
    inp.onchange = ()=>{
      const i=parseInt(inp.dataset.idx);
      const v=inp.value===''?null:Math.max(1,Math.min(10,parseInt(inp.value)));
      inp.value = v===null?'':String(v);
      indicatorScores[curDomain][curAge][i]=v;
      saveLS(true);
      renderMonthlyChart();
      renderSmallCharts(true);
    };
  });
}
function renderMonthlyChart(){
  const wrap=document.getElementById('monthlyChart');
  wrap.innerHTML='';
  const labels=(INDICATOR_TEXT[curDomain]?.[curAge]||[]).map((_,i)=>'æŒ‡æ ‡'+(i+1));
  const real=indicatorScores[curDomain]?.[curAge]||[];
  const stdv=parseInt(document.getElementById('stdLine').value||'8');
  const std=labels.map(()=>stdv);

  const W=720, H=300, x0=50, y0=10, w=W-70, h=230;
  const svg=createSVG(W,H);
  renderGrid(svg, x0,y0,w,h, 0,10,2);
  renderXAxis(svg, x0,y0,w,h, labels);

  // æ ‡å‡†çº¿ï¼ˆç°è™šçº¿ï¼‰
  const stdPts=toPoints(std, x0,y0,w,h, 0,10);
  const stdD=segmentedPath(stdPts);
  drawPath(svg, stdD, '#9ca3af', 2, '6,6');

  // å®é™…å€¼
  const realPts=toPoints(real, x0,y0,w,h, 0,10);
  const realD=segmentedPath(realPts);
  drawPath(svg, realD, 'currentColor', 2);
  drawPoints(svg, realPts, 3);

  wrap.appendChild(svg);
}
function avg10(arr){
  const vals = arr.filter(v=>typeof v==='number');
  if(!vals.length) return null;
  const avg = vals.reduce((a,b)=>a+b,0)/vals.length;
  return Math.round(avg*10);
}
function buildDomainSeries(domain){
  return AGE_LIST.map(a=> avg10(indicatorScores[domain]?.[a]||[]) );
}
function smallChartOptions(){ return {}; } // å ä½ï¼ŒSVGæ–¹æ¡ˆæ— éœ€æ­¤é¡¹

function renderSmallChart(dom, container){
  const base=REF_DEFAULT[dom] || [40,55,65,75,82,88];
  const ub=base.map(v=>v+REF_BAND);
  const lb=base.map(v=>v-REF_BAND);
  const real=buildDomainSeries(dom);
  const labels=AGE_LIST.map(a=>a+'æœˆ');

  const W=720, H=260, x0=50, y0=10, w=W-70, h=190;
  const svg=createSVG(W,H);
  renderGrid(svg, x0,y0,w,h, 0,100,20);
  renderXAxis(svg, x0,y0,w,h, labels);

  const ubPts=toPoints(ub, x0,y0,w,h, 0,100);
  const basePts=toPoints(base, x0,y0,w,h, 0,100);
  const lbPts=toPoints(lb, x0,y0,w,h, 0,100);
  const realPts=toPoints(real, x0,y0,w,h, 0,100);

  drawPath(svg, linePath(ubPts), 'currentColor', 1, '6,6');
  drawPath(svg, linePath(basePts), 'currentColor', 2, '2,6');
  drawPath(svg, linePath(lbPts), 'currentColor', 1, '6,6');
  drawPath(svg, segmentedPath(realPts), 'currentColor', 2);
  drawPoints(svg, realPts, 3);

  container.appendChild(svg);
}
function renderSmallCharts(force=false){
  const wrap=document.getElementById('smallCharts');
  if(force) wrap.innerHTML='';
  if(!wrap.children.length){
    DOMAINS.forEach(dom=>{
      const card=document.createElement('div'); card.className='card';
      card.innerHTML = `<h2>${dom}</h2><div class="small-chart"></div>`;
      wrap.appendChild(card);
    });
  }
  const io = new IntersectionObserver((entries)=>{
    entries.forEach(en=>{
      if(en.isIntersecting){
        const title=en.target.querySelector('h2').textContent;
        const panel=en.target.querySelector('.small-chart');
        if(!panel.dataset.rendered){ renderSmallChart(title, panel); panel.dataset.rendered='1'; }
        io.unobserve(en.target);
      }
    });
  },{root:null, threshold:.2});
  wrap.querySelectorAll('.card').forEach(c=>io.observe(c));
}

// ====== SVGå·¥å…· ======
function createSVG(w,h){ const svg=document.createElementNS('http://www.w3.org/2000/svg','svg'); svg.setAttribute('viewBox',`0 0 ${w} ${h}`); svg.setAttribute('role','img'); return svg; }
function linePath(points){ return points.map((p,i)=> (i?'L':'M')+p[0].toFixed(2)+','+p[1].toFixed(2)).join(' '); }
function segmentedPath(points){ let d='', seg=[]; points.forEach(p=>{ if(p===null){ if(seg.length>1){ d+=(d?' ':'')+linePath(seg);} seg=[];} else{ seg.push(p);} }); if(seg.length>1){ d+=(d?' ':'')+linePath(seg);} return d; }
function renderGrid(svg, x0,y0, w,h, yMin,yMax,yStep){
  const g=document.createElementNS(svg.namespaceURI,'g');
  for(let y=yMin; y<=yMax; y+=yStep){
    const yy = y0 + h - (y - yMin) / (yMax - yMin) * h;
    const line=document.createElementNS(svg.namespaceURI,'line');
    line.setAttribute('x1',x0); line.setAttribute('x2',x0+w); line.setAttribute('y1',yy); line.setAttribute('y2',yy);
    line.setAttribute('stroke','var(--line)'); line.setAttribute('stroke-width','1');
    g.appendChild(line);
    const txt=document.createElementNS(svg.namespaceURI,'text');
    txt.setAttribute('x', x0-6); txt.setAttribute('y', yy+4);
    txt.setAttribute('text-anchor','end'); txt.setAttribute('font-size','12'); txt.setAttribute('fill','var(--fg)');
    txt.textContent = y;
    g.appendChild(txt);
  }
  svg.appendChild(g);
}
function renderXAxis(svg, x0,y0,w,h, labels){
  const g=document.createElementNS(svg.namespaceURI,'g');
  const n=labels.length;
  for(let i=0;i<n;i++){
    const xx=x0 + (n===1?0:(i*(w/(n-1))));
    const txt=document.createElementNS(svg.namespaceURI,'text');
    txt.setAttribute('x',xx); txt.setAttribute('y', y0+h+16);
    txt.setAttribute('text-anchor','middle'); txt.setAttribute('font-size','12'); txt.setAttribute('fill','var(--fg)');
    txt.textContent=labels[i];
    g.appendChild(txt);
  }
  svg.appendChild(g);
}
function toPoints(values, x0,y0,w,h, yMin,yMax){
  const n=values.length; const pts=[];
  for(let i=0;i<n;i++){
    const v=values[i];
    if(v===null || typeof v!=='number'){ pts.push(null); continue; }
    const x=x0 + (n===1?0:(i*(w/(n-1))));
    const y=y0 + h - (v - yMin)/(yMax - yMin)*h;
    pts.push([x,y]);
  }
  return pts;
}
function drawPath(svg, d, stroke, width, dash){
  const p=document.createElementNS(svg.namespaceURI,'path');
  p.setAttribute('d', d); p.setAttribute('fill','none'); p.setAttribute('stroke', stroke); p.setAttribute('stroke-width', width);
  if(dash) p.setAttribute('stroke-dasharray', dash);
  svg.appendChild(p);
}
function drawPoints(svg, points, radius){
  points.forEach(p=>{
    if(!p) return;
    const c=document.createElementNS(svg.namespaceURI,'circle');
    c.setAttribute('cx', p[0]); c.setAttribute('cy', p[1]); c.setAttribute('r', radius);
    c.setAttribute('fill','currentColor');
    svg.appendChild(c);
  });
}

// ====== å…¶å®ƒ ======
function demoFill(){
  const arr = indicatorScores[curDomain][curAge];
  for(let i=0;i<arr.length;i++){
    arr[i] = Math.floor(6+Math.random()*5); // 6-10
  }
  saveLS(true);
  updateIndicatorsTable();
  renderMonthlyChart();
  renderSmallCharts(true);
}
function clearThisMonth(){
  const arr = indicatorScores[curDomain][curAge];
  for(let i=0;i<arr.length;i++){ arr[i]=null; }
  saveLS(true);
  updateIndicatorsTable();
  renderMonthlyChart();
  renderSmallCharts(true);
}
function toggleTheme(){
  const root=document.documentElement; const cur=root.getAttribute('data-theme')||'light';
  const next=cur==='light'?'dark':'light';
  root.setAttribute('data-theme', next);
  saveLS(false, next);
  renderMonthlyChart();
  renderSmallCharts(true);
}
function saveLS(hint=false, theme){
  const data = { indicatorScores, homeScores, theme: theme || document.documentElement.getAttribute('data-theme') };
  localStorage.setItem(LS_KEY, JSON.stringify(data));
  if(hint) toast('å·²ä¿å­˜');
  document.getElementById('jsonPreview').textContent = JSON.stringify({version:'v2.6.1',indicatorScores,homeScores}, null, 2);
}
function loadLS(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(!raw) return null;
    const obj = JSON.parse(raw);
    if(obj.theme){ document.documentElement.setAttribute('data-theme', obj.theme); }
    return obj;
  }catch(e){ return null; }
}
function toast(msg){
  const el=document.getElementById('saveHint');
  el.textContent=msg;
  setTimeout(()=>{el.textContent='';},1200);
}
function switchTab(idx){
  [...document.querySelectorAll('.tab')].forEach((t,i)=>t.classList.toggle('active', i===idx));
  for(let i=0;i<4;i++){ document.getElementById('tab-'+i).hidden = i!==idx; }
  if(idx===1){ renderSmallCharts(true); }
  if(idx===3){ document.getElementById('jsonPreview').textContent = JSON.stringify({version:'v2.6.1',indicatorScores,homeScores}, null, 2); }
}
</script>
</body>
</html>
